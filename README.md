# Blink program written in Ada for the NeoRV32 (LiteX + ULX3S)

The program was used to showcase the use of Ada in FOSDEM 2023.

## Components

The program uses Alire to manage its dependencies and build
procedures. It depends on the `neorv32_litex_hal` crate, which is
still not publicly available in the Alire index, but it can be found
in this same Github account.

In order to generate the startup and linker scripts, the
[startup-gen](https://github.com/AdaCore/startup-gen) program was
used. [This
blog-post](https://blog.adacore.com/ada-on-any-arm-cortex-m-device-in-just-a-couple-minutes)
explains how that is done. The values for the different memory regions
where taken from the SVD file that can be automatically generated by
[LiteX](https://github.com/enjoy-digital/litex).

The `__gnat_exit` procedure has to be defined by the user in order to
ensure what happens if the program somehow exits. This should not
happen under normal conditons, but we should always have it just in
case. This procedure is found in `src/led_exit.ads`.

## Build

In order to build the program, first clone the
[neorv32_litex_hal](https://github.com/Irvise/neorv32_litex_hal) crate
in the same directory where this project is cloned. It should look
like this:
```
.
├── led_blink
├── neorv32_litex_hal
├── startup_gen_23.0.0_f9b12904
└── svd2ada
```
The `startup_gen_23.0.0_f9b12904` and `svd2ada` folders are not needed
unless you plan on developing the crates further.

Once this is all setup, `cd led_blink` and run `alr build`. This will
generate an `elf` file in `led_blink/bin`. You will also find the
`led_blink.hex` file. It is automatically generated after a successful
build by calling `riscv64-elf-objcopy` to transform the `elf` file
into a running binary file.



